---
title: "Senegal HIV model"
author: "Fabricia F. Nascimento"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Senegal HIV model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette will demonstrate how to estimate HIV transmission rates using DNA sequences from Senegal. This also provides a guidance on how analysis described in Nascimento, (...), Volz, 2018 was carried out. 

## Basic requirements
This vignette assumes that you know the basics of R and have the following packages already installed:

* devtools: useful for installing packages directly from github         repository, for example. 
* phydynR: it implements the coalescent simulation and likelihood       function for phylodynamics analysis
* akima: this package is necessary for interpolation of data (used      for the calculation of the likelihood by the phydynR package)
* BayesianTools: package for Bayesian inference

### Load the necessary packages:
```r
  library(phydynR)
  library(akima)
  library(BayesianTools)
```

## The Model
The model we fit is based on the structured coalescent models (ref). These models are used to estimate epidemiological parameters using a phylogenetic tree and information on states of each tip of the tree. Theses states are discrete-trait information representing each sequences.

In our mathematical model we have 4 different discrete-traits:

* __gpf__ = HIV sample from the general population -- females;
* __gpm__ = HIV sample from the general population -- males;
* __msm__ = HIV sample from men that have sex with other men;
* __src__ = source sample, which are HIV sample from individuals that are              from other countries and not from Senegal 

We fit the HIV epidemic in Senegal using ordinary differential equations (ODE) and only 1 stage of infection. We used 1 stage of infection, because the metadata available for the Senegal sequences did not have information that we could use to determine the stage of HIV infection at the time the sample was collected.

Transmission was modelled in a way that:

* __msm__ could transmite to __msm__
* __msm__ could transmit to __gpf__
* __gpf__ could transmit to __msm__
* __gpf__ could transmit to __gpm__
* __gpm__ could transmit to __gpf__

The ODEs, or model equations, are:

\begin{aligned}
\dot{I}_{msm} &= [p_{msm}I_{msm} + (1 - p_{f})I_{msm}] \lambda(t) - \gamma I_{msm}  \\
\dot{I}_{gpf} &= [p_{f}I_{gpf} + (1 - p_{msm})I_{gpf}] \lambda(t) - \gamma I_{gpf}  \\
\dot{I}_{gpm} &= (m_xI_{gpm}) \lambda(t) - \gamma I_{gpm}
\end{aligned}







`gpf`, `gpm`, `msm`, and `src` are the demes of our model, and are represented in R as:
```{r}
demes <- c('gpm', 'gpf', 'msm', 'src')
```

Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
