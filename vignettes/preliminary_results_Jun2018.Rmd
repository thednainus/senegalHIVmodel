---
title: "Preliminary results"
author: "Fabricia F. Nascimento"
date: "`r Sys.Date()`"
output:
  rmarkdown::pdf_document:
    fig_caption: true
    df_print: kable
    highlight: pygments
fontsize: 12pt
vignette: >
  %\VignetteIndexEntry{Preliminary results}
  %\VignetteEngine{rmarkdown::render}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(knitr.table.format = "latex")
```

# Variations of the model I tested

## Model 2:

Model modified by you. Only sequences from Dakar.

## Model 3:

Same as model 2, but removing from the tree sequences from self-reported _gpm_.

## Model 4:

Same as model 2, but coding self-reported _gpm_ as being 0.5 _gpm_ and 0.5 _msm_.

## by subtype 02_AG model 1:

All sequences from subtype 02_AG and from Senegal, coding self-reported _gpm_ as 1.0.

## by subtype 02_AG model 2:

All sequences from subtype 02_AG and from Senegal, but coding self-reported _gpm_ and being 0.5 _gpm_ and 0.5 _msm_.

## by subtype C model 1:

All sequences from subtype C and from Senegal, coding self-reported _gpm_ as 1.

## by subtype C model 2:

All sequences from subtype C and from Senegal, but coding self-reported _gpm_ and being 0.5 _gpm_ and 0.5 _msm_.


```{r echo = FALSE}
load(system.file("data/mcmc_runs/mergedRuns_newModel.rda",
                                    package = "senegalHIVmodel"))
# MAP after removing first 3,000 iterations
model2 <- BayesianTools::MAP(m2.l.m, start=3000)
model2.p <- as.numeric(format(round(model2$parametersMAP, 3), nsmall = 3))
model2.p[[15]] <- model2$valuesMAP[[1]]

names(model2.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                      "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                      "import", "srcNe",
                      "pmsm2msm", "pgpf2gpm",
                      "initmsm", "initgp", "Lposterior"))
# MAP after removing first 800 iterations
model3 <- BayesianTools::MAP(m3.m, start=800)
model3.p <- as.numeric(format(round(model3$parametersMAP, 3), nsmall = 3))
model3.p[[15]] <- model3$valuesMAP[[1]]
names(model3.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                      "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                      "import", "srcNe",
                      "pmsm2msm", "pgpf2gpm",
                      "initmsm", "initgp", "Lposterior"))
# MAP after removing first 2,000 iterations
model4 <- BayesianTools::MAP(m4.l.m, start=2000)
model4.p <- as.numeric(format(round(model4$parametersMAP, 3), nsmall = 3))
model4.p[[15]] <- model4$valuesMAP[[1]]
names(model4.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                      "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                      "import", "srcNe",
                      "pmsm2msm", "pgpf2gpm",
                      "initmsm", "initgp", "Lposterior"))
# MAP after removing first 800 iter
m02_AG_m1 <- BayesianTools::MAP(m02_AG.m, start=800)
m02_AG_m1.p <- as.numeric(format(round(m02_AG_m1$parametersMAP, 3), nsmall = 3))
m02_AG_m1.p[[15]] <- m02_AG_m1$valuesMAP[[1]]
names(m02_AG_m1.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                         "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                         "import", "srcNe",
                         "pmsm2msm", "pgpf2gpm",
                         "initmsm", "initgp", "Lposterior"))
# MAP after removing first 800 iter
m02_AG_m2 <- BayesianTools::MAP(m02_AG.m2, start=800)
m02_AG_m2.p <- as.numeric(format(round(m02_AG_m2$parametersMAP, 3), nsmall = 3))
m02_AG_m2.p[[15]] <- m02_AG_m2$valuesMAP[[1]]
names(m02_AG_m2.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                         "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                         "import", "srcNe",
                         "pmsm2msm", "pgpf2gpm",
                         "initmsm", "initgp", "Lposterior"))
# MAP after removing 800 iterations
mC_m1 <- BayesianTools::MAP(mC.m, start=800)
mC_m1.p <- as.numeric(format(round(mC_m1$parametersMAP, 3), nsmall = 3))
mC_m1.p[[15]] <- mC_m1$valuesMAP[[1]]
names(mC_m1.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                     "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                     "import", "srcNe",
                     "pmsm2msm", "pgpf2gpm",
                     "initmsm", "initgp", "Lposterior"))
#MAP for model 2 subtype C
mC_m2 <- BayesianTools::MAP(m2.mC.m, start=800)
mC_m2.p <- as.numeric(format(round(mC_m2$parametersMAP, 3), nsmall = 3))
mC_m2.p[[15]] <- mC_m2$valuesMAP[[1]]
names(mC_m2.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                     "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                     "import", "srcNe",
                     "pmsm2msm", "pgpf2gpm",
                     "initmsm", "initgp", "Lposterior"))

data_list = data.frame(model2.p, model3.p, model4.p, m02_AG_m1.p, m02_AG_m2.p, mC_m1.p, mC_m2.p) 
data_list <- as.matrix(data_list)
colnames(data_list)<-c("M2","M3", "M4", "02_AG: m1", "02_AG: m2", "C: m1", "C: m2")

kable_table <- knitr::kable(data_list, booktabs = T, caption =  "MAP for preliminary MCMC runs: 14   parameters")
kableExtra::kable_styling(kable_input = kable_table,
                          latex_options = c("striped", "scale_down"),
                          full_width = FALSE, position = "center")

```

```{r echo = FALSE}
load(system.file("data/mcmc_runs/mergedRuns_newModels_maleX_rd2.rda",
                                    package = "senegalHIVmodel"))
# MAP after removing first 1,000 iterations
model2.mx <- BayesianTools::MAP(m2.mx.m_rd2, start=1000)
model2.mx.p <- as.numeric(format(round(model2.mx$parametersMAP, 3), nsmall = 3))
model2.mx.p[[16]] <- model2.mx$valuesMAP[[1]]
names(model2.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                         "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                         "maleX", "import", "srcNe",
                         "pmsm2msm", "pgpf2gpm",
                         "initmsm", "initgp", "Lposterior"))
# MAP after removing first 1,000 iterations
model3.mx <- BayesianTools::MAP(m3.mx.m_rd2, start=1000)
model3.mx.p <- as.numeric(format(round(model3.mx$parametersMAP, 3), nsmall = 3))
model3.mx.p[[16]] <- model3.mx$valuesMAP[[1]]
names(model3.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                         "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                         "maleX", "import", "srcNe",
                         "pmsm2msm", "pgpf2gpm",
                         "initmsm", "initgp", "Lposterior"))
# MAP after removing first 1,000 iterations
model4.mx <- BayesianTools::MAP(m4.mx.m_rd2, start=1000)
model4.mx.p <- as.numeric(format(round(model4.mx$parametersMAP, 3), nsmall = 3))
model4.mx.p[[16]] <- model4.mx$valuesMAP[[1]]
names(model4.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                       "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                       "maleX", "import", "srcNe",
                       "pmsm2msm", "pgpf2gpm",
                       "initmsm", "initgp", "Lposterior"))
# MAP after removing first 1,300 iter
m02_AG_m1.mx <- BayesianTools::MAP(m02_AG.mx.m_rd2, start=1300)
m02_AG_m1.mx.p <- as.numeric(format(round(m02_AG_m1.mx$parametersMAP, 3), nsmall = 3))
m02_AG_m1.mx.p[[16]] <- m02_AG_m1.mx$valuesMAP[[1]]
names(m02_AG_m1.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                            "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                            "maleX", "import", "srcNe",
                            "pmsm2msm", "pgpf2gpm",
                            "initmsm", "initgp", "Lposterior"))
# MAP after removing first 1,500 iter
m02_AG_m2.mx <- BayesianTools::MAP(m2.m02_AG.mx.m_rd2, start=1500)
m02_AG_m2.mx.p <- as.numeric(format(round(m02_AG_m2.mx$parametersMAP, 3), nsmall = 3))
m02_AG_m2.mx.p[[16]] <- m02_AG_m2.mx$valuesMAP[[1]]
names(m02_AG_m2.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                            "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                            "maleX", "import", "srcNe",
                            "pmsm2msm", "pgpf2gpm",
                            "initmsm", "initgp", "Lposterior"))
# MAP after removing 1000 iterations
mC_m1.mx <- BayesianTools::MAP(mC.mx.m_rd2, start=1000)
mC_m1.mx.p <- as.numeric(format(round(mC_m1.mx$parametersMAP, 3), nsmall = 3))
mC_m1.mx.p[[16]] <- mC_m1.mx$valuesMAP[[1]]
names(mC_m1.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                        "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                        "maleX", "import", "srcNe",
                        "pmsm2msm", "pgpf2gpm",
                        "initmsm", "initgp", "Lposterior"))
#MAP for model 2 subtype C
mC_m2.mx <- BayesianTools::MAP(m2.mC.mx.m_rd2, start=1000)
mC_m2.mx.p <- as.numeric(format(round(mC_m2.mx$parametersMAP, 3), nsmall = 3))
mC_m2.mx.p[[16]] <- mC_m2.mx$valuesMAP[[1]]
names(mC_m2.mx.p) <- (c("gpsp0", "gpsp1", "gpsp2", "gpsploc",
                    "msmsp0", "msmsp1", "msmsp2", "msmsploc",
                    "maleX", "import", "srcNe",
                    "pmsm2msm", "pgpf2gpm",
                    "initmsm", "initgp", "Lposterior"))



data_list.mx = data.frame(model2.mx.p, model3.mx.p, model4.mx.p, m02_AG_m1.mx.p, m02_AG_m2.mx.p, mC_m1.mx.p, mC_m2.mx.p) 
data_list.mx <- as.matrix(data_list.mx)
colnames(data_list.mx)<-c("M2","M3", "M4", "02_AG: m1", "02_AG: m2", "C: m1", "C: m2")

kable_table.mx <- knitr::kable(data_list.mx, booktabs = T, caption =  "MAP for preliminary MCMC runs: 15 parameters")
kableExtra::kable_styling(kable_input = kable_table.mx,
                          latex_options = c("striped", "scale_down"),
                          full_width = FALSE, position = "center")

```

# Line Plots: 14 parameters
```{r echo = FALSE}
library(reshape2)
library(ggplot2)
# create dataframe to make plots
MAP_models <- data.frame(model2.p, model3.p, model4.p, m02_AG_m1.p, m02_AG_m2.p, mC_m1.p, mC_m2.p)

MAP_models_t <- data.frame(t(MAP_models[-15,]))
MAP_models_t["model"] <- rownames(MAP_models_t)

MAP_models_long <- melt(MAP_models_t, id.vars="model")


#plots
gpsp_values <- MAP_models_long[c(1:21),]
gpsp_values$model <- as.factor(gpsp_values$model)

ggplot(data=gpsp_values, aes(x=variable, y=value, group=model, shape=model, colour=model)) +
  geom_line(aes(linetype=model), size=0.5) +     # Set linetype by sex
  geom_point(size=2, fill="white") +         # Use larger points, fill with white
  expand_limits(y=0) +                       # Set y range to include 0
  scale_colour_hue(name="Model",      # Set legend title
                   l=30)  +                  # Use darker colors (lightness=30)
  scale_shape_manual(name="Model",
                     values=c(0, 15, 1, 16, 2, 18, 5)) +      # Use points with a fill color
  scale_linetype_discrete(name="Model") +
  xlab("parameter") + ylab("value") + # Set axis labels
  theme_bw() + ggtitle("Shape parameter for gp") +
  theme(legend.position=c(.7, .7))           # Position legend inside
# This must go after theme_bw

```

```{r echo = FALSE}
msmsp_values <- MAP_models_long[c(29:49),]
msmsp_values$model <- as.factor(msmsp_values$model)

ggplot(data=msmsp_values, aes(x=variable, y=value, group=model, shape=model, colour=model)) +
  geom_line(aes(linetype=model), size=0.5) +     # Set linetype by sex
  geom_point(size=2, fill="white") +         # Use larger points, fill with white
  expand_limits(y=0) +                       # Set y range to include 0
  scale_colour_hue(name="Model",      # Set legend title
                   l=30)  +                  # Use darker colors (lightness=30)
  scale_shape_manual(name="Model",
                     values=c(0, 15, 1, 16, 2, 18, 5)) +      # Use points with a fill color
  scale_linetype_discrete(name="Model") +
  xlab("parameter") + ylab("value") + # Set axis labels
  theme_bw() + ggtitle("Shape parameter for msm") +
  theme(legend.position=c(.86, .7))           # Position legend inside
# This must go after theme_bw

```

# Line Plots: 15 parameters
```{r echo = FALSE}
library(reshape2)
library(ggplot2)
# create dataframe to make plots
MAP_models.mx <- data.frame(model2.mx.p, model3.mx.p, model4.mx.p, m02_AG_m1.mx.p, m02_AG_m2.mx.p, mC_m1.mx.p, mC_m2.mx.p)

MAP_models_t.mx <- data.frame(t(MAP_models.mx[-16,]))
MAP_models_t.mx["model"] <- rownames(MAP_models_t.mx)

MAP_models_long.mx <- melt(MAP_models_t.mx, id.vars="model")


#plots
gpsp_values.mx <- MAP_models_long.mx[c(1:21),]
gpsp_values.mx$model <- as.factor(gpsp_values.mx$model)

ggplot(data=gpsp_values.mx, aes(x=variable, y=value, group=model, shape=model, colour=model)) +
  geom_line(aes(linetype=model), size=0.5) +     # Set linetype by sex
  geom_point(size=2, fill="white") +         # Use larger points, fill with white
  expand_limits(y=0) +                       # Set y range to include 0
  scale_colour_hue(name="Model",      # Set legend title
                   l=30)  +                  # Use darker colors (lightness=30)
  scale_shape_manual(name="Model",
                     values=c(0, 15, 1, 16, 2, 18, 5)) +      # Use points with a fill color
  scale_linetype_discrete(name="Model") +
  xlab("parameter") + ylab("value") + # Set axis labels
  theme_bw() + ggtitle("Shape parameter for gp") +
  theme(legend.position=c(.7, .7))           # Position legend inside
# This must go after theme_bw

```

```{r echo = FALSE}
msmsp_values.mx <- MAP_models_long.mx[c(29:49),]
msmsp_values.mx$model <- as.factor(msmsp_values.mx$model)

ggplot(data=msmsp_values.mx, aes(x=variable, y=value, group=model, shape=model, colour=model)) +
  geom_line(aes(linetype=model), size=0.5) +     # Set linetype by sex
  geom_point(size=2, fill="white") +         # Use larger points, fill with white
  expand_limits(y=0) +                       # Set y range to include 0
  scale_colour_hue(name="Model",      # Set legend title
                   l=30)  +                  # Use darker colors (lightness=30)
  scale_shape_manual(name="Model",
                     values=c(0, 15, 1, 16, 2, 18, 5)) +      # Use points with a fill color
  scale_linetype_discrete(name="Model") +
  xlab("parameter") + ylab("value") + # Set axis labels
  theme_bw() + ggtitle("Shape parameter for msm") +
  theme(legend.position=c(.86, .7))           # Position legend inside
# This must go after theme_bw

```
